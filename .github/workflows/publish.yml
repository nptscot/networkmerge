on:
    workflow_dispatch:
    push:
      # on any branch:
      branches: [main, 64-improve-reproducibility]
  
name: Quarto Publish

jobs:
  docker:
    runs-on: ubuntu-latest
    container: ghcr.io/geocompx/docker:suggests
    steps:
      - name: Install gh cli
        run: |
          type -p curl >/dev/null || (sudo apt update && sudo apt install curl -y)
          curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg \
          && sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg \
          && echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null \
          && sudo apt update \
          && sudo apt install gh -y
      - name: Check out repository
        uses: actions/checkout@v4
      - uses: r-lib/actions/setup-renv@v2

#       - name: Install deps
#         # Run the script in .devcontainer/install-additional-dependencies.sh
#         run: bash .devcontainer/install-additional-dependencies.sh
      - name: Render and Publish
        uses: quarto-dev/quarto-actions/publish@v2
        with:
          target: gh-pages
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}