<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Will Deakin">
<meta name="author" content="Zhao Wang">
<meta name="author" content="Josiah Parry">
<meta name="author" content="Robin Lovelace">

<title>Route network simplification for transport planning – networkmerge</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-1713c1db1ad41a796903378fc9ac7b2b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">networkmerge</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./paper.html" aria-current="page"> 
<span class="menu-text">Networkmerge paper</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./cookbook.html"> 
<span class="menu-text">parenx cookbook</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./methods.html"> 
<span class="menu-text">Methods</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./slides.html"> 
<span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.npt.scot"> 
<span class="menu-text">Network Planning Tool web application with simplified network</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#sec-problem" id="toc-sec-problem" class="nav-link" data-scroll-target="#sec-problem"><span class="header-section-number">2</span> Problem definition</a></li>
  <li><a href="#sec-methods" id="toc-sec-methods" class="nav-link" data-scroll-target="#sec-methods"><span class="header-section-number">3</span> Data and Methods</a>
  <ul class="collapse">
  <li><a href="#sec-simplification-via-skeletonisation" id="toc-sec-simplification-via-skeletonisation" class="nav-link" data-scroll-target="#sec-simplification-via-skeletonisation"><span class="header-section-number">3.1</span> Simplification via skeletonisation</a></li>
  <li><a href="#sec-simplification-via-voronoi-polygons" id="toc-sec-simplification-via-voronoi-polygons" class="nav-link" data-scroll-target="#sec-simplification-via-voronoi-polygons"><span class="header-section-number">3.2</span> Simplification via Voronoi polygons</a></li>
  <li><a href="#post-processing" id="toc-post-processing" class="nav-link" data-scroll-target="#post-processing"><span class="header-section-number">3.3</span> Post-Processing</a></li>
  <li><a href="#skeletonisation-versus-voronoi" id="toc-skeletonisation-versus-voronoi" class="nav-link" data-scroll-target="#skeletonisation-versus-voronoi"><span class="header-section-number">3.4</span> Skeletonisation versus Voronoi</a></li>
  </ul></li>
  <li><a href="#sec-application" id="toc-sec-application" class="nav-link" data-scroll-target="#sec-application"><span class="header-section-number">4</span> Application to Edinburgh City Centre</a></li>
  <li><a href="#sec-discussion" id="toc-sec-discussion" class="nav-link" data-scroll-target="#sec-discussion"><span class="header-section-number">5</span> Discussion and Conclusion</a></li>
  <li><a href="#data-availability" id="toc-data-availability" class="nav-link" data-scroll-target="#data-availability"><span class="header-section-number">6</span> Data Availability</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements"><span class="header-section-number">7</span> Acknowledgements</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">8</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Route network simplification for transport planning</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Will Deakin <a href="https://orcid.org/0009-0008-5656-4469" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Digital, Data and Technology services, Network Rail, UK
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Zhao Wang <a href="https://orcid.org/0000-0002-4054-0533" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Leeds Institute for Transport Studies, University of Leeds, UK
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Josiah Parry <a href="https://orcid.org/0000-0001-9910-865X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Environmental Systems Research Institute, Redlands, CA, USA
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Robin Lovelace <a href="https://orcid.org/0000-0001-5679-6536" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Leeds Institute for Transport Studies, University of Leeds, UK
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<!-- # Reproducibility {.unnumbered} -->
<!-- <details>



To contribute to the papers written as quarto documents (with `.qmd` extensions) like this one, we recommend using the Quarto extension for VS Code.
You can go into the visual editor with the following shortcut:

```         
Ctrl+Shift+F4
```

You can then add citations with Ctrl+Shift+F11 and benefit from Quarto's other features for academic writing.

</details> -->
<section id="abstract" class="level1 unnumbered">
<h1 class="unnumbered">Abstract</h1>
<p>Route network datasets are fundamental to transport models, serving as both inputs for analysis and outputs for visualisation and decision-making. The increasing complexity of route network data from sources like OpenStreetMap allows for more detailed modelling of sustainable transport modes such as walking and cycling. However, this level of detail can introduce challenges for the clear visualisation and interpretation of model results. A common problem is the representation of single transport corridors by multiple parallel lines, which can create visual clutter and obscure important patterns in transport flows. The purpose of the work presented in this paper is to provide a basis for computationally efficient analysis and visualisation of route networks for strategic transport planning, where intricate geometries, such as parallel or ‘braided’ linestrings, are unhelpful. We present and evaluate two distinct methods for simplifying complex route networks that are intended to be used as a ‘pre‑processing’ step to speed up and improve the results of strategic transport network analysis, modelling and visualisation workflows. First, we present <strong>skeletonisation</strong>, an approach that uses ‘thinning’ of rasterised network data to extract a simplified representation of the network. Second, we present a <strong>Voronoi‑based</strong> approach using Voronoi diagrams to identify centrelines. We demonstrate the practical application of these methods using the “Simplified network” layer in the Transport for Scotland funded Network Planning Tool, a publicly accessible resource at <a href="https://www.npt.scot">www.npt.scot</a>. To support reproducible research, we implement the methods in the open-source <code>parenx</code> Python package, enabling their use alongside other open source tools for transport planning, research and educational applications.</p>
</section>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Datasets representing route networks are foundational to transport planning, serving a dual role as both inputs to and outputs from transport models. As inputs, they provide the digital representation of the physical world on which transport systems operate. As outputs, they are used to visualise the results of transport models, for example showing levels of predicted demand or network performance on specific routes. More specifically, transport network datasets are <em>spatial networks</em> composed of nodes (vertices or junctions) and edges (links or ways), where each edge has an associated cost, such as its length or travel time <span class="citation" data-cites="barthélemy2011">(<a href="#ref-barthélemy2011" role="doc-biblioref">Barthélemy 2011</a>)</span>. In practice, these components are geographically located, with edges representing the physical infrastructure of the transport network, often enriched with attributes like the type of way (e.g., motorway, cycle path), its physical characteristics, and usage data such as daily traffic volumes. Accordingly, route network simplification can be applied to both input and output networks, aiming to reduce complexity while preserving the essential spatial structure and relevant attributes of the network.</p>
<p>In this paper (and associated code repository and Methods and Cookbook appendices), we articulate the problem of complex route networks, present two open‑source and reproducible simplification methods—skeletonisation and a Voronoi‑based centreline approach—and demonstrate their application to support more effective transport planning. The primary aim is to provide transport planners with tools to simplify complex route networks as a ‘pre‑processing’ step in existing transport modelling workflows. More broadly, we aim to contribute to wider multi-disciplinary efforts in spatial network analysis and network simplification.</p>
<p>To avoid ambiguity, we set out key terms and how they are used consistently in the paper. A spatial network is the abstract, graph-theoretic object embedded in geographic space (nodes and edges with geometry) <span class="citation" data-cites="barthélemy2011">(<a href="#ref-barthélemy2011" role="doc-biblioref">Barthélemy 2011</a>)</span>. A transport network dataset is a concrete geospatial dataset typically saved as a vector geographic dataset in a GeoPackage (.gpkg), GeoJSON (.geojson), or similar geographic file format that encodes a spatial network representing linear transport infrastructure <span class="citation" data-cites="kujala2018">(<a href="#ref-kujala2018" role="doc-biblioref">Kujala et al. 2018</a>)</span>. ‘Route network’ can be used interchangeably with transport network but the emphasis is on the travel demand on the network, which can be calculated by aggregating many routes (e.g., model outputs) into a consolidated set of corridors <span class="citation" data-cites="morgan2020 moral-carcedo2024">(<a href="#ref-morgan2020" role="doc-biblioref">Morgan and Lovelace 2020</a>; <a href="#ref-moral-carcedo2024" role="doc-biblioref">Moral-Carcedo 2024</a>)</span>. We reserve “spatial network” for statements about the underlying graph concept.</p>
<p>The growing availability of high-resolution geographic datasets, from open sources including OpenStreetMap <span class="citation" data-cites="openstreetmap">(<a href="#ref-openstreetmap" role="doc-biblioref">OpenStreetMap contributors 2024</a>)</span> and government-funded mapping agencies <span class="citation" data-cites="ordnancesurvey">(<a href="#ref-ordnancesurvey" role="doc-biblioref">Ordnance Survey 2025</a>)</span>, has enabled the creation of increasingly detailed maps. This trend, powered by advances in hardware and software, is beneficial for sustainable transport planning, which relies on accurate and detailed network information. However, the very intricacy of modern street network geometries can create significant problems. For transport model outputs to be useful to planners and the public, a clear and intuitive visual representation is crucial for identifying issues such as bottlenecks, congestion hotspots, and areas of poor accessibility. Consequently, network simplification has become a vital step in the transport planning workflow, aligning with established cartographic principles of ‘map generalisation’ for pre‑processing datasets according to the scale of analysis <span class="citation" data-cites="sutton1998">(<a href="#ref-sutton1998" role="doc-biblioref">Sutton 1998</a>)</span>. Despite being a long-standing challenge, the simplification of networks for transport planning and other applications remains an active area of research.</p>
<p>Existing vector geometry simplification methods, such as the Douglas-Peucker and Visvalingam-Whyatt algorithms, are effective at reducing the number of vertices in a line and thus file sizes, but they do not address the problem of network complexity arising from multiple parallel lines representing a single real-world corridor <span class="citation" data-cites="liu2020vector de2014efficient">(<a href="#ref-liu2020vector" role="doc-biblioref">Liu et al. 2020</a>; <a href="#ref-de2014efficient" role="doc-biblioref">Magalhaes et al. 2014</a>)</span>. Similarly, vector smoothing techniques can improve the aesthetic quality of network visualisations; however, they do not simplify the underlying network structure <span class="citation" data-cites="pradhan2023modified duong2022statistical">(<a href="#ref-pradhan2023modified" role="doc-biblioref">Pradhan and Pradhan 2023</a>; <a href="#ref-duong2022statistical" role="doc-biblioref">Duong 2022</a>)</span>.</p>
<p>A more promising approach involves converting the linear network into an intermediate polygon (buffer) layer and then deriving a simplified centreline, or ‘medial axis’. This concept has been explored in various open-source software implementations <span class="citation" data-cites="smogavec2012 centerli2023">(e.g. <a href="#ref-smogavec2012" role="doc-biblioref">Smogavec and Žalik 2012</a>; <a href="#ref-centerli2023" role="doc-biblioref"><span>“Centerline - Crates.io: Rust Package Registry”</span> 2023</a>)</span>. Recent work in this area includes the <code>neatnet</code> Python package <span class="citation" data-cites="fleischmann2025adaptivecontinuitypreservingsimplificationstreet">(<a href="#ref-fleischmann2025adaptivecontinuitypreservingsimplificationstreet" role="doc-biblioref">Fleischmann et al. 2025</a>)</span> and the <code>parenx</code> package <span class="citation" data-cites="deakin2024">(<a href="#ref-deakin2024" role="doc-biblioref">Deakin 2024</a>)</span>, the latter of which forms the basis of the methods presented in this paper. Other related methods focus on identifying and removing specific types of network artefacts, such as small loops or ‘slivers’ between dual carriageways to simplify street blocks <span class="citation" data-cites="fleischmann2024 grippa2018">(<a href="#ref-fleischmann2024" role="doc-biblioref">Fleischmann, Vybornova, and Gaboardi 2024</a>; <a href="#ref-grippa2018" role="doc-biblioref">Grippa et al. 2018</a>)</span>. However, these methods often lack the flexibility to control the level of simplification.</p>
<p>While the focus of this paper is on route network simplification for transport planning, and applications to other fields are beyond its scope, it is worth noting prior research tackling the challenge of simplifying linear features in other domains. In hydrology, for example, researchers require simplified centrelines of rivers derived from datasets representing river banks for applications such as flood mapping and morphological analysis, with implementations in tools like the R package <code>cmgo</code> <span class="citation" data-cites="golly2017">(<a href="#ref-golly2017" role="doc-biblioref">Golly and Turowski 2017</a>)</span> and RivWidthCloud for Google Earth Engine <span class="citation" data-cites="yang2020">(<a href="#ref-yang2020" role="doc-biblioref">Yang et al. 2020</a>)</span>. The <code>riverdist</code> R package also provides functionality to simplify braided river channels into a single path <span class="citation" data-cites="tyers2016">(<a href="#ref-tyers2016" role="doc-biblioref">Tyers 2016</a>)</span>. The methods presented in this paper draw inspiration from these wider applications of linear feature simplification. More broadly, our approach is based on techniques that can be applied to any set of overlapping linear features where aggregation is desired, such as simplifying transport or other flow networks to create a consolidated route-view for capacity analysis or strategic modelling.</p>
<p>We proceed as follows: <a href="#sec-problem" class="quarto-xref">Section&nbsp;2</a> outlines the problem of complex route networks. <a href="#sec-methods" class="quarto-xref">Section&nbsp;3</a> presents methods for route network simplification alongside results based on the example datasets. <a href="#sec-application" class="quarto-xref">Section&nbsp;4</a> demonstrates the methods applied to a real transport network (Edinburgh, Scotland) and <a href="#sec-discussion" class="quarto-xref">Section&nbsp;5</a> concludes with a discussion of the results and future work. Details on the methods and their application are provided in the <a href="https://nptscot.github.io/networkmerge/methods.html">Methods</a> appendix. Furthermore, the <a href="https://nptscot.github.io/networkmerge/cookbook.html">Cookbook</a> appendix provides a practical guide to using the methods via the open-source <code>parenx</code> Python package.</p>
</section>
<section id="sec-problem" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Problem definition</h1>
<p>The problem tackled in this paper is the simplification of complex route networks. This can be illustrated with reference to the Propensity to Cycle Tool for England (PCT) <span class="citation" data-cites="lovelace2017">(<a href="#ref-lovelace2017" role="doc-biblioref">Lovelace et al. 2017</a>)</span>, the route networks of which are based on methods for aggregating multiple overlapping routes into a route network with non-overlapping linestrings <span class="citation" data-cites="morgan2020">(<a href="#ref-morgan2020" role="doc-biblioref">Morgan and Lovelace 2020</a>)</span>. Implemented in the function <code>overline()</code> in the <code>stplanr</code> R package <span class="citation" data-cites="lovelace2017">(<a href="#ref-lovelace2017" role="doc-biblioref">Lovelace et al. 2017</a>)</span>, the methods enable visualisation of large transport networks and inform investment decisions in transport planning internationally <span class="citation" data-cites="lovelace2024 félix2025">(<a href="#ref-lovelace2024" role="doc-biblioref">Lovelace et al. 2024</a>; <a href="#ref-félix2025" role="doc-biblioref">Félix, Moura, and Lovelace 2025</a>)</span>. However, without further processing, the ‘overline’ approach has two practical limitations: it retains functionally redundant vertices, leading to large file sizes and slow rendering; and it does not merge parallel ways that represent a single corridor. This lack of merging is particularly problematic for visualisation of transport networks, as shown in <a href="#fig-pct" class="quarto-xref">Figure&nbsp;1</a>. The left panel shows Otley Road with a flow value of 818 (<a href="#fig-otley-road" class="quarto-xref">Figure&nbsp;1 (a)</a>). The right panel, by contrast, shows three parallel ways with flow values of 515 (shown), 288 and 47 (values not shown) (<a href="#fig-armley-road" class="quarto-xref">Figure&nbsp;1 (b)</a>). Although this section of Armley road has a higher cycling potential than the section of Otley Road shown (515 + 288 + 47 = 850, which is greater than 818), this is not clear from the visualisation.</p>
<div id="fig-pct" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pct-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-pct" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-otley-road" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-otley-road-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/otley-road-narrow.png" id="fig-otley-road" class="img-fluid figure-img" style="width:80.0%" data-ref-parent="fig-pct">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-otley-road-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-pct" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-armley-road" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-armley-road-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/armley-road-narrow.png" id="fig-armley-road" class="img-fluid figure-img" style="width:80.0%" data-ref-parent="fig-pct">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-armley-road-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-pct" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-otley-road-raster" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-otley-road-raster-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/otley-road-raster.png" id="fig-otley-road-raster" class="img-fluid figure-img" style="width:80.0%" data-ref-parent="fig-pct">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-otley-road-raster-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c)
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-pct" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-armley-road-raster" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-armley-road-raster-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/armley-road-raster.png" id="fig-armley-road-raster" class="img-fluid figure-img" style="width:80.0%" data-ref-parent="fig-pct">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-armley-road-raster-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pct-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Vector (top) and raster (bottom) visualisations of route network results in the Propensity to Cycle Tool. Note that it is not clear from the visualisation that the corridor shown in the right hand figures (Armley Road corridor) has greater flow than the corridor shown in the left (Otley Road). Note also the visual artefacts such as ‘staircase’ effects and overlapping values resulting from parallel lines along Armley Road (right panel). Source: open access Propensity to Cycle Tool results available at www.pct.bike.
</figcaption>
</figure>
</div>
<p>In this paper, “simplification” means reducing the complexity of geometries representing transport networks by aggregating multiple parallel or braided lines into a single centreline while preserving the network’s spatial structure and connectivity. Two key elements of this simplification process are replacing 2 or more parallel lines with a single line and converting complex intersections (e.g.&nbsp;a roundabout) into a single node. Both of these are illustrated in <a href="#fig-skeleton-line" class="quarto-xref">Figure&nbsp;2</a> for method-level examples and <a href="#fig-results" class="quarto-xref">Figure&nbsp;3</a> for a city-centre application (see the <a href="https://nptscot.github.io/networkmerge/methods.html">Methods</a> appendix for details).</p>
<!-- A subsequent step described by @morgan2020 is to post-process the geographic representation of the transport network into a raster image, which can be used to visualise the network.
The 'rasterisation' stage can tackle some of the issues associated with multiple parallel ways, but introduces new issues, as shown in @fig-rasterisation. -->
<!-- ::: {#fig-rasterisation layout-ncol="2"}


Rasterised network results for the same corridors shown in @fig-pct.
Source: open access Propensity to Cycle Tool results available at www.pct.bike.
::: -->
<!-- The methods presented in this paper are designed to take a complex network as an input and output a simplified network, while preserving the spatial structure of the network and relevant attributes.
By reducing duplicated parallel lines and other intricacies, the outputs can enable easier-to-interpret visualisations of transport behaviour on the network patterns and behaviours. -->
</section>
<section id="sec-methods" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data and Methods</h1>
<p>In this paper we use the two street networks discussed in the previous section to illustrate the methods. See the <a href="https://nptscot.github.io/networkmerge/methods.html">Methods</a> and <a href="https://nptscot.github.io/networkmerge/cookbook.html">‘<code>parenex</code> cookbook’</a> appendices for further details on the methods used in this paper and their application to alternative (railway based) datasets.</p>
<p>In addition to these illustrative street-corridor examples, we apply the same pipelines to a real-world dataset for central Edinburgh derived from OpenStreetMap and analysed in a projected CRS (EPSG:27700). Unless otherwise stated, parameters (e.g., buffer size) are kept consistent across methods to enable a fair comparison; the full application is described in <a href="#sec-application" class="quarto-xref">Section&nbsp;4</a>.</p>
<p>There are two main challenges that need to be overcome to simplify transport networks, in a way that preserves their value:</p>
<ol type="1">
<li>Simplifying the <em>geometry</em></li>
<li>Assigning attributes to the simplified network</li>
</ol>
<p>We address the geometric simplification first, describing skeletonisation and then a Voronoi‑based approach. The key contributions of the paper are the novel methods of image skeletonisation, presented in <a href="#sec-simplification-via-skeletonisation" class="quarto-xref">Section&nbsp;3.1</a>, and simplification with Voronoi diagrams to identify central lines, covered in <a href="#sec-simplification-via-voronoi-polygons" class="quarto-xref">Section&nbsp;3.2</a>.</p>
<section id="sec-simplification-via-skeletonisation" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-simplification-via-skeletonisation"><span class="header-section-number">3.1</span> Simplification via skeletonisation</h2>
<p>The skeletonisation approach generates a simplified network by buffering the network, applying an image skeletonisation algorithm, and extracting line segments from a raster of this buffer. For an example of the resulting outputs, see the “Skeletonised” column of <a href="#fig-skeleton-line" class="quarto-xref">Figure&nbsp;2</a> (Otley: top row; Armley: bottom row).</p>
<p>As a common first step, we buffer the lines in a projected coordinate system. We use a buffer size of 8 m in this paper, a value informed by typical widths of a UK two‑lane highway with an example for a typical 2‑way road being specified in the <a href="https://assets.publishing.service.gov.uk/media/5a7e0035ed915d74e6223743/pdfmanforstreets.pdf#page=81">Design Manual for Roads and Bridges (DMRB)</a> as “min 4.8 m, max 8.8 m” and the minimum GB rail centreline track separation of 3.26 m, and two sections of 1.435 m standard gauge. This parameter can be adjusted to suit the use case and local contexts, using the <code>buffer</code> parameter of the simplification functions.</p>
<p>In skeletonisation, overlapping lines are identified, buffered, transformed into a raster image, the image processed through a thinning algorithm, and a skeletal representation of the original network produced (see <a href="https://nptscot.github.io/networkmerge/methods.html">Methods</a> appendix for details). This skeletal structure preserves the overall extent and connectivity of the network, with a central line that follows the centreline of the combined buffered area.</p>
<p>Specifically, we apply skeletonisation only where more than one buffered line segment overlaps. To identify overlapping line-segments, the buffer is split at the end of each line-segment. The overlapping line-segments are then buffered while retaining the remaining disjoint lines.</p>
<!---This visualisation demonstrates the process of cutting and segmenting the buffer geometries. It highlights the transformations from the initial buffered geometries to a more segmented and manageable form, preparing them for further analysis and simplification steps​.
It effectively highlights the contrast between the more intricate and the simpler sections within these networks. --->
<!-- ::: {#fig-split-ends layout-ncol="2"} -->
<!--- Truncated and segmented buffer geometries of the Otley Road (left) and Armley Road (right) networks.
::: --->
<!-- Segmented line-buffer geometries (top) and geometries to be skeletonised (bottom) for the Otley Road (left) and Armley Road (right) networks. -->
<!-- ::: -->
<p>To mitigate rasterisation artefacts introduced by this step, we increase resolution via a uniform affine scale before thinning. As detail is lost in transforming of the geometry to an image buffer or raster, more detail can be retained by using an affine transformation to increase the number of points in the buffer prior to skeletonisation and reducing scale when creating the simplified linear geometric representation. This scale operation is a uniform affine scale transformation applied to increase the detail contained in the raster image. An increase in scale reduces undulation but at the cost of longer processing time and increased memory, which varies as the square of scale value. This transformation is scaled to ensure that the projected coordinate geometry of the network aligns accurately with the corresponding dimensions of the scaled raster image.</p>
<p>Additionally, we pre-process the raster to eliminate small holes that appear where buffered lines run parallel or intersect at shallow angles. The skeletonisation algorithm is then applied to the raster image, yielding a skeletal raster image that is converted back into a linear vector geometry, completing the vector-to-raster-to-vector geometry transformation (see <a href="https://nptscot.github.io/networkmerge/methods.html">Methods</a> appendix for details).</p>
<!-- ::: {#fig-rasterize layout-ncol="2"}

::: {.cell}

:::



::: {.cell}

:::


Rasterised versions of the Otley Road (left) and Armley Road (right) networks, with post‑processing to remove small holes.
::: -->
<!---The image undergoes a thinning process, yielding a skeletal raster image as the result.
This skeletonised image effectively captures the essential structure and layout of the original network, as illustrated in @fig-thin-skeleton. --->
<!-- ::: {#fig-thin-skeleton layout-ncol="2"} -->
<!-- Skeletonised versions of the Otley Road (left) and Armley Road (right) networks. -->
<!-- ::: -->
<!-- ### Recreating a linear geometry -->
<!-- Figure commented out as not necessary and similar to the subsequent figure: -->
<!-- ::: {#fig-skeleton-vector layout-ncol="2"} -->
<!-- Skeletonised versions of the Otley Road (left) and Armley Road (right) networks, transformed back into point geometry.

::: -->
<p>After thinning, we convert the skeleton back to vectors by connecting adjacent pixels into segments and merging them into continuous lines. Line segments are then created by connecting these adjacent points. These segments are combined, giving a continuous line geometry representing the simplified network. Finally, a reverse scaling affine transformation is applied to return to the original coordinate system. <!-- This conversion from point to line geometry is a pivotal aspect of network simplification. --></p>
<p>Among these stages, the point-to-line reconstruction is the most complex.</p>
<!-- The resulting simplified network is illustrated in @fig-skeleton-line. -->
<!-- ::: {#fig-skeleton-line layout-ncol="2"} -->
<!-- Simplified versions of the Otley Road (left) and Armley Road (right) networks, transformed back into line geometry. -->
<!-- ::: -->
</section>
<section id="sec-simplification-via-voronoi-polygons" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-simplification-via-voronoi-polygons"><span class="header-section-number">3.2</span> Simplification via Voronoi polygons</h2>
<p>In contrast to skeletonisation, the Voronoi method remains in vector space until the end and derives centrelines from buffered boundaries. Voronoi simplification takes the buffered network segments and converts them into a set of points. The edges of these buffers are then segmented into sequences of points. From these sequences, a centreline is derived based on a set of Voronoi polygons that cover these points. For more detail on segmentation and Voronoi simplification see the <a href="https://nptscot.github.io/networkmerge/methods.html#sec-simplification-via-voronoi-polygons">Appendix</a>. This approach facilitates the creation of a simplified network representation by focusing on the central alignment of the buffered lines. For examples of the resulting outputs, see the “Voronoi” column of <a href="#fig-skeleton-line" class="quarto-xref">Figure&nbsp;2</a> (Otley: top row; Armley: bottom row).</p>
<!-- ::: {#fig-boundary layout-ncol="2"} -->
<!-- Simplified boundaries of the Otley Road (left) and Armley Road (right) networks. -->
<!-- ::: -->
<!-- @fig-segment showcase the conversion of segmented LineString geometries into point geometries. -->
<!-- This essential transformation forms the basis for constructing Voronoi diagrams. -->
<!-- ::: {#fig-segment layout-ncol="2"} -->
<!-- Detail segmented boundaries of the Otley Road (left) and Armley Road (right) networks. -->
<!-- ::: -->
<!-- @fig-voronoi-point, the process of converting the segmented LineString geometries into point geometries is illustrated. -->
<!-- This transformation is essential for the creation of Voronoi diagrams. -->
<!-- ::: {#fig-voronoi-point layout-ncol="2"} -->
<!-- Detail point segement of the Otley Road (left) and Armley Road (right) networks. -->
<!-- ::: -->
<!-- we probably want to pick Voronoi #1 or Voronoi #2. I'd marginally favour #2 -->
<!-- In @fig-voronoi-2, the generation and clipping of the corresponding Voronoi diagrams to the bounds of the input geometry is depicted. -->
<!-- ::: {#fig-voronoi layout-ncol="2"} -->
<!-- Clipped Voronoi diagrams of the Otley Road (left) and Armley Road (right) networks.

<!-- ::: -->
<!-- ### Voronoi 2 -->
<!-- ::: {#fig-voronoi-2 layout-ncol="2"} -->
<!-- Clipped Voronoi diagrams of the Otley Road (left) and Armley Road (right) networks. -->
<!-- ::: -->
<!-- ### Voronoi simplified network -->
<p>From the Voronoi diagram, we retain only edges entirely within the buffer and within half a buffer width of the boundary. The final centreline is then cleaned by removing knot-like artefacts, which tend to be more prevalent in Voronoi outputs.</p>
<!-- ::: {#fig-voronoi-simplified layout-ncol="2"} -->
<!-- Voronoi diagram lines with lines that are completely within the buffer geometry and less than half-a-buffer-width from the buffer edge. -->
<!-- ::: -->
<!--- ### Voronoi simplified network --->
<div id="fig-skeleton-line" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-skeleton-line-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Original</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-37-3.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Skeletonised</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-38-5.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Voronoi</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-39-7.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Original</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-40-9.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Skeletonised</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-41-11.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Voronoi</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-skeleton-line-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Original and simplified versions of the Otley Road (top) and Armley Road (bottom) networks. From left to right: original network, skeletonised network, Voronoi simplified network.
</figcaption>
</figure>
</div>
</section>
<section id="post-processing" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="post-processing"><span class="header-section-number">3.3</span> Post-Processing</h2>
<p>Both skeletonisation and Voronoi outputs require post‑processing to remove ‘knots’ (short, tangled segments that form near intersections). To remove these features, short segments are clustered together, and a central point for each cluster is determined. The end-points of longer lines that connect to these segment clusters are then realigned to the cluster’s central point, as illustrated in the <a href="https://nptscot.github.io/networkmerge/methods.html">Methods</a> appendix.</p>
<p>An additional optional stage is to simplify the network further by removing vertices that are not essential for the network’s connectivity, resulting in a primal network that captures the essential connectivity and layout of transport routes. The primal network is thus composed of direct lines connecting start and end points, representing a high level of simplification that prioritises the network’s structure and compression.</p>
<!-- The primal networks for the Otley Road and Armley Road skeletonised networks are illustrated in @fig-primal-skeleton. -->
<!-- ::: {#fig-primal-skeleton layout-ncol="2"} -->
<!-- Primal skeletonised networks for the Otley Road (left) and Armley Road (right) networks. -->
<!-- ::: -->
<!-- ### Primal network -->
<!-- @fig-primal-voronoi illustrates the primal network derived from the Voronoi approach. -->
<!-- ::: {#fig-primal-voronoi layout-ncol="2"} -->
<!-- Primal Voronoi networks for the Otley Road (left) and Armley Road (right) networks. -->
<!-- ::: -->
<!-- ![](images/paste-1.png) -->
<p>See the <a href="https://nptscot.github.io/networkmerge/methods.html">Methods</a> and <a href="https://nptscot.github.io/networkmerge/cookbook.html"><code>parenx</code> cookbook</a> appendices for details on the methods, implementation, and how to run the pipelines on your own data.</p>
</section>
<section id="skeletonisation-versus-voronoi" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="skeletonisation-versus-voronoi"><span class="header-section-number">3.4</span> Skeletonisation versus Voronoi</h2>
<p>With both pipelines defined, we summarise known limitations and performance trade-offs. Both the skeletonisation and Voronoi approaches are generic methods with the following known issues: they do not preserve links between attributes and the simplified network, nor do they identify subsets of edges that require simplification. Additionally, the resulting lines can be wobbly. The simplification process is memory- and CPU-intensive, and its speed depends on network density and overlap. On commodity hardware, simplifying a core urban road network of 1 km extent takes about 5 seconds, while a 3 km urban core takes 30–60 seconds. Although the Voronoi output is significantly smoother, it is typically 3.6–5.1 times slower than skeletonisation.</p>
<p>Based on available computing resources, the Voronoi algorithm is used for smaller networks (e.g., those covering approximately 1 km²), while the skeletonisation algorithm is preferred for larger areas (such as 100 km²). Notably, skeletonisation of the entire British rail centreline network took about 5 hours.</p>
<!-- **Data Preparation:** -->
<!-- The main inputs of the network merging function are two route networks: `rnet_x` (the simple network geometry) and `rnet_y` (the original network with a more complex geometry and attributes that need to be translated onto the new network). -->
<!-- `rnet_y` in this case represents the detailed network with attributes such as model outputs representing transport flows to be translated onto the new network. -->
<!-- **Step 1: Coordinate Reference System Alignment** -->
<!-- Transform the spatial data of both `rnet_x` (the simplified network) and `rnet_y` (the detailed network) to the same coordinate reference system.
For this project, we have selected EPSG:27700. -->
<!-- **Step 2: Defining the Function List** -->
<!-- Create a function list that dictates how each attribute is to be processed:

-   **Exclude**: "geometry" from processing.

-   **Mean Function**: Applied to attributes like "Gradient" and "Quietness".
    TODO expline the funtion of sum and mean

-   **Sum Function**: Used for aggregating values in columns such as "all_bicycle".

**Step 3: Using `stplanr::rnet_merge` for Integration**

Employ the `rnet_merge` function from the `stplanr` package.
This function is designed to merge route network data, taking into account the predefined functions and alignment in the coordinate system. -->
<!-- The network joining function can also take a number of arguments that define how the attributes are translated to the simplified target network:

-   **`dist`** (Buffer Distance): This parameter defines the buffer zone around `rnet_xp` in metres, for determining the proximity at which features from both networks are considered for merging.
    Typically, this value is refined to approximate the width of streets, ensuring a realistic spatial correlation between the network elements.

-   **`segment_length`** (Maximum Segment Length): This optional argument (with 0 being the default meaning no splitting) specifies the maximum length of segments in `rnet_y` before they are split.
    Segmenting long segments in the detailed network reduces number of source geometries that do not fit within target geometries, which can be key for achieving higher accuracy in attribute integration. -->
<!-- -   **`funs`** (Function List): Comprises a series of key-value pairs representing variable names and the function to apply to each.
    Any function can be used, with sum and mean being typical values.

-   **`max_angle_diff`** (Maximum Angular Difference): This argument specifies the maximum angular difference between segments and target lines for values in matching source geometries to be translated to the target simplified geometries.
    A low value, such as 20 degrees, ensures that values are translated only to segments with similar orientations, preventing overestimation of values on side roads.
    @fig-max_angle_diff demonstrates the impact of this parameter in preventing the overestimation of values on side roads. -->
<!-- ::: {#fig-max_angle_diff layout-ncol="1"}
![The effect of setting `max_angle_diff` to 20 degrees compared to a null value, illustrating the reduction in value overestimation on side roads](pics/Prevent%20overestimate%20of%20values%20on%20sideroads.png)

The effect of setting `max_angle_diff` to 20 degrees compared to a null value, illustrating the reduction in value overestimation on side Roads.
::: -->
<!-- An optional `sum_flows` argument can be used to ensure that more influential lines have a proportionate impact on the final aggregated value for each geometry in the simplified network.
The formula for the weighted sum is:

$$
\text{Weighted Sum} = \sum (x_i \times w_i)
$$

Where `xi` represents the attribute value for the i-th line in the complex network, and `wi` is the length weight for the i-th line. -->
<!-- An optional normalization step adjusts the values associated with each feature in the simplified network.
This adjustment ensures that the total flow values of both the complex and simplified networks are equivalent.
The need for normalization arises from the fact that simplified networks typically have a reduced total length and are less circuitous compared to their complex counterparts. -->
<!-- The normalization process is governed by the following formula:

$$
\text{Normalized Value} = \frac{\text{Weighted Sum}}{\sum w_i}
$$

Additionally, to account for potential overestimation of values in the simplified network, the following formula is applied:

$$
\text{over\_estimate} = \frac{\sum(\text{Aggregated Value} \times \text{Length of Single Line})}{\sum(\text{Original Value} \times \text{Length of Lines in Complex Network})}
$$

The final step involves adjusting the normalized value to correct any overestimation, as calculated above:

$$
\text{Adjusted Value} = \frac{\text{Normalized Value}}{\text{over\_estimate}}
$$

Through these steps, the normalized and adjusted values more accurately reflect the true distribution and intensity of flows within the simplified network, preserving the overall data integrity. -->
<!-- Content for long form appendix?: -->
<!-- To calculate max_angle_diff, it's necessary to accurately calculate the angles (bearings) of lines from two networks, rnet_x$angle_x and rnet_y$angle_y.
The difference in these angles is then computed as rnetj$angle_diff <- rnetj$angle_y - rnetj\$angle_x.
In this study, the line_bearing function is defined to calculate the angle.
As shown below,
       
rnet$angle = line_bearing(rnet_y, bidirectional = TRUE)

The process of calculating the bidirectional bearing of a line segment in geographical coordinates involves normalizing the standard bearing so that it is the same regardless of the direction of travel along the line.
Below is the detailed formula:

1.  **Convert Latitudes and Longitudes to Radians**:

$$
\text{lat}_1 = \text{lat}_1 \times \frac{\pi}{180}
$$

$$
\text{lat}_2 = \text{lat}_2 \times \frac{\pi}{180}
$$

$$
\text{lon}_1 = \text{lon}_1 \times \frac{\pi}{180}
$$

$$
\text{lon}_2 = \text{lon}_2 \times \frac{\pi}{180}
$$

2.  **Calculate Bearing**:

$$
\Delta lon = lon_2 - lon_1
$$

$$
\theta = atan2(\sin(\Delta lon) \times \cos(lat_2), \cos(lat_1) \times \sin(lat_2) - \sin(lat_1) \times \cos(lat_2) \times \cos(\Delta lon))
$$

3.  **Convert Bearing from Radians to Degrees and Normalize Bidirectional Bearing to \[0, 180) Degrees**:

$$
\theta = \theta \times \frac{180}{\pi}
$$

$$
\theta = \theta \mod 180
$$

In this bidirectional adjustment, the bearing is normalized to a range of \[0, 180) degrees.
This means that opposite directions along a line yield the same bearing value.
This approach is particularly useful in scenarios where the directionality of the line is not a primary concern, ensuring consistency in bearing values regardless of the line's travel direction. 
-->
<!-- ![image](pics/Prevent_overestimate_of_values_on_sideroads.png) -->
<!-- After the joining process has completed, a series of post-processing steps can refine the results:

-   **Cleaning**: The `rnet_merged` dataset undergoes an initial cleaning phase where superfluous columns are removed.
    This step enhances dataset manageability and focuses on relevant data by eliminating columns such as 'identifier' and 'length_x'.

-   **Dimensionality Reduction**: Z and M dimensions are removed from the dataset, as they are redundant for our analysis and contribute to unnecessary increases in file size.
  This reduction simplifies the dataset and optimises it for storage and processing efficiency.

-   **NA Handling**: A thorough examination is conducted for the presence of NA values across the columns.
    Any rows where all the targeted columns contain NA values are filtered out.

-   **Spatial Subsetting**: Following the removal of linestrings that contain NA attributes from the `rnet_merged` dataset, we proceed to create a geometric buffer zone.
    This zone serves as a spatial criterion for identifying and retaining only those geometries that lie outside of this buffer.
    A subset of `rnet_yp`, termed `rnet_yp_rest`, is then delineated based on this spatial relationship, effectively omitting any geometries that intersect with or fall within the buffered area.
    This step ensures that only those components of `rnet_y` which are spatially distinct from `rnet_merged` are retained for further consideration.

-   **Network Simplification**: In the final stage of simplification, the datasets `rnet_yp_rest` and `rnet_merged_all` are combined to form the final network, which retains the simplicity of the original simplified structure while concurrently encompassing the detailed attributes, thereby providing a comprehensive yet efficient foundation for further analysis.

These post-processing steps are adaptable and can be customized according to the specific requirements of the analysis. -->
<!-- TODO: add content to this section. -->
<!-- TODO: Is this possible? -->
<!-- ## Combined network simplification and attribute merging -->
</section>
</section>
<section id="sec-application" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Application to Edinburgh City Centre</h1>
<p>To demonstrate the practical application of the proposed simplification techniques, we apply them to central Edinburgh’s road network. In this section we focus on an area around 1 km ‘wide’ (east-west) and 0.5 km ‘tall’ (north-south), focused on the multi-lane Princes Street. The network of streets includes multi-lane roads, historic winding streets and roundabouts. The resulting OpenStreetMap representation of this area is shown in <a href="#fig-results" class="quarto-xref">Figure&nbsp;3</a> (top). This case study shows how the methods work on complex urban networks beyond the simplified corridor examples shown in the previous section. It demonstrates how they can be used in transport planning workflows, and highlights the trade-offs between different simplification approaches in a realistic setting. The results of applying the proposed simplification methods are shown in the remaining subfigures of <a href="#fig-results" class="quarto-xref">Figure&nbsp;3</a>, which shows how both methods succeed in collapsing dual carriageways into single centrelines while preserving overall connectivity. The resulting network geometries are ‘cleaner’ than the original, making them a strong basis for interpreting flows or other attributes.</p>
<p>The visual comparison reveals important insights about each method’s strengths and limitations. The skeletonisation approach, while effective at consolidating parallel carriageways, occasionally produces slight geometric distortions near complex intersections, where the raster-to-vector conversion process can introduce minor offsets or curves. These artefacts, while generally minor, can affect the aesthetic quality of the output and may require manual correction for presentation purposes.</p>
<p>In contrast, the Voronoi method demonstrates superior handling of intersection geometries, producing cleaner alignments that more closely follow the natural centrelines of intersecting streets. This advantage comes at a computational cost, with processing times typically 3-5 times longer than skeletonisation for equivalent network sizes. The method’s vector-based approach preserves more of the original geometric relationships, resulting in outputs that are often more suitable for high-quality cartographic presentation.</p>
<p>It is notable that the <code>neatnet</code> implementation <span class="citation" data-cites="fleischmann2025adaptivecontinuitypreservingsimplificationstreet">(<a href="#ref-fleischmann2025adaptivecontinuitypreservingsimplificationstreet" role="doc-biblioref">Fleischmann et al. 2025</a>)</span> results in a network that is similar to the Voronoi output, but with some differences such as effective removal of the complex roundabout at the top of the sub-figures and a single ‘stranded’ linestring in the central western part of the network. The comparison with the <code>neatnet</code> package provides valuable context for understanding how different algorithmic approaches handle the same underlying challenge. While <code>neatnet</code> achieves effective simplification of complex features like the roundabout in the northern portion of the study area, it occasionally produces fragmented segments that require additional post-processing. This fragmentation, visible as isolated linestrings in the central western area, suggests that different parameter settings or additional processing steps may be needed to achieve fully connected networks.</p>
<p>The differences between each approach and the official centreline network highlight that there is no single ‘right’ answer, indicating that the flexibility of the methods and input parameters is important to achieve the desired outcome for a specific application. Still, the results suggest that more work is needed to achieve more automated outputs that ‘just work’ for many use cases in which simplification is required: none of the outputs are perfect from visual or network connectivity perspectives.</p>
<p>Finally, the primal network shown in the bottom subfigure of <a href="#fig-results" class="quarto-xref">Figure&nbsp;3</a> represents the highest level of simplification. This network is created by removing all nodes that are not intersections, effectively representing the network as a series of direct connections between junctions. This level of abstraction can be useful for strategic network analysis, where the focus is on connectivity and network structure rather than precise geographical representation. The downsides of the more drastic primal results are clear from the sudden sharp angles and discontinuities that can arise, particularly around ‘loops’.</p>
<p>From a practical transport planning perspective, the simplified networks offer several advantages over the original OpenStreetMap data. The consolidation of dual carriageways into single centrelines reduces visual clutter and makes it easier to identify traffic flow patterns and bottlenecks. The preservation of network connectivity ensures that routing algorithms and accessibility analyses remain valid, while the reduced geometric complexity improves computational performance for network analysis tasks.</p>
<p>Overall, the application to Edinburgh city centre demonstrates that both the skeletonisation and Voronoi methods are capable of transforming a complex, detailed road network into a range of simplified representations suitable for different transport planning and analysis purposes. The choice of method and level of simplification will depend on the specific requirements of the task, from creating clear visualisations of model outputs to conducting high-level strategic network analysis.</p>
<!-- TODO: improve the figure layout. -->
<div class="cell">
<div class="cell-output-display">
<div id="fig-results" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/edinburgh_simplification.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Results of the route network simplification methods applied to Edinburgh city centre. The input dataset (top left) and road centrelines from Ordnance Survey’s OpenRoads (©Crown copyright and database right 2025) released under the Open Government License (OGL) (top right) are shown for reference. Skeletonised (middle left), Voronoi (middle right) and primal network (bottom left) outputs are shown. A network simplified by the neatnet Python package is also shown (bottom right).
</figcaption>
</figure>
</div>
</div>
</div>
<!--- Matrix of Route Network Simplification Stages across Armley, Edinburgh, and Doncaster Rail. --->
<!-- @fig-apply_results presents the comparison results, showcasing the Edinburgh road network simplified by the proposed method.
It is observed that the attribute `value` from the original network has been correctly transferred to the simplified network via a `sum` calculation process.
This comparison between the original and simplified Edinburgh Road Networks demonstrates the effectiveness of the proposed simplification techniques in maintaining the essential characteristics of the network while reducing its complexity. -->
<!-- ::: {#fig-apply_results} -->
</section>
<section id="sec-discussion" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Discussion and Conclusion</h1>
<p>This paper has presented and evaluated two complementary approaches for simplifying complex route networks, addressing a fundamental challenge in transport planning and spatial analysis. The skeletonisation method transforms rasterised network buffers into clean centrelines through iterative thinning algorithms <span class="citation" data-cites="leymarie1992">(<a href="#ref-leymarie1992" role="doc-biblioref">Leymarie and Levine 1992</a>)</span>, while the Voronoi-based approach generates centrelines by constructing spatial diagrams that identify natural medial axes within buffered network geometries <span class="citation" data-cites="smogavec2012">(<a href="#ref-smogavec2012" role="doc-biblioref">Smogavec and Žalik 2012</a>)</span>. Both methods are implemented in the open-source <code>parenx</code> Python package, ensuring reproducibility and accessibility for the research community.</p>
<p>Our evaluation demonstrates that both approaches successfully consolidate multiple parallel linestrings representing single transport corridors into unified centrelines while maintaining network connectivity and spatial structure. The Edinburgh case study illustrates this capability on a real urban network, showing how both methods can transform complex multi-lane road representations into simplified geometries suitable for analysis and visualisation. The results indicate that skeletonisation provides faster processing with good geometric accuracy, while the Voronoi method delivers superior aesthetic quality and cleaner intersection handling at the cost of increased computational time. Recent performance benchmarks comparing the computational efficiency of <code>neatnet</code> <span class="citation" data-cites="fleischmann2025adaptivecontinuitypreservingsimplificationstreet">(<a href="#ref-fleischmann2025adaptivecontinuitypreservingsimplificationstreet" role="doc-biblioref">Fleischmann et al. 2025</a>)</span> and <code>parenx</code> implementations suggest substantial room for improvement in our implementation, motivating future work on computational efficiency in both Voronoi-based and skeletonisation approaches.</p>
<p>The practical implications for transport planning workflows are significant. Simplified networks reduce file sizes and rendering times, making them more suitable for web-based interactive tools and large-scale strategic analysis. The consolidation of parallel carriageways into single centrelines eliminates visual clutter, enabling clearer identification of traffic flow patterns, congestion hotspots, and infrastructure investment priorities. This improvement in data quality directly supports evidence-based decision making in transport planning, from local traffic management to regional strategic network development.</p>
<p>The flexibility of our implementation allows users to select appropriate levels of simplification based on their specific needs. For routine applications requiring rapid processing of large networks, skeletonisation provides an efficient solution. For high-quality cartographic outputs or detailed geometric analysis, the Voronoi approach offers superior results despite its computational cost. The ability to generate primal networks—representing only essential connectivity between intersections—further extends the utility for strategic planning applications where topological structure takes precedence over detailed geometry.</p>
<p>Looking ahead, several promising directions exist for extending this work. The development of hybrid approaches combining the computational efficiency of skeletonisation with the geometric quality of Voronoi methods could provide optimal solutions for different use cases. Performance optimisation through parallel processing, implementation in lower-level languages, or algorithmic improvements could reduce processing times, making these methods more accessible for large-scale applications. Integration with existing transport modelling workflows, particularly automated attribute transfer from complex to simplified networks, represents another important area for development. A further challenge, which is beyond the scope of this paper, is attribute conflation: joining attributes from the source network to the simplified network. This was not part of <code>parenx</code> and was not used in the Edinburgh application. However, we note that tools for this purpose exist, including the <code>rnet_merge()</code> function in the <code>stplanr</code> R package <span class="citation" data-cites="lovelace2019">(<a href="#ref-lovelace2019" role="doc-biblioref">Lovelace, Ellison, and Morgan 2019</a>)</span> and <code>anime</code> Rust crate for fast and flexible many-to-many segment matching, a robust basis for attribute joins <span class="citation" data-cites="parry_josiahparryanime_2025">(<a href="#ref-parry_josiahparryanime_2025" role="doc-biblioref">Parry 2025</a>)</span>. Network joining can be regarded as a ‘fuzzy’ or ‘keyless’ join process <span class="citation" data-cites="suri2021 wachowicz2019">(<a href="#ref-suri2021" role="doc-biblioref">Suri et al. 2021</a>; <a href="#ref-wachowicz2019" role="doc-biblioref">Wachowicz and Mrozek 2019</a>)</span>: as with the network simplification steps outlined above, the user must select joining parameters to maximise the accuracy of the join. Describing different joining strategies and implementations would be a logical next step for future work.</p>
<p>Beyond transport planning, these methods have potential applications across multiple domains involving linear feature aggregation. In hydrology, they could support automated river centreline extraction from complex braided river systems. Utility network management could benefit from simplified pipeline and cable representations for maintenance planning. Ecological corridor analysis might use these techniques to create consolidated habitat connectivity maps from fragmented landscape data. The fundamental approach of converting complex overlapping linear features into simplified centrelines has broad applicability wherever spatial network simplification is required.</p>
<p>This work contributes to the broader goal of making transport planning more effective, evidence-based, and accessible by providing robust, flexible tools for network simplification. The open-source implementation ensures that these methods can be adapted and improved by the wider research community, supporting continued advancement in spatial network analysis and transport system planning.</p>
</section>
<section id="data-availability" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Data Availability</h1>
<p>All data and code used to generate the results presented in this paper are available in the GitHub repository for this paper: https://github.com/nptscot/networkmerge. To ensure that the paper is fully reproducible, continuous integration rebuilds the paper whenever changes are pushed to the repository.</p>
</section>
<section id="acknowledgements" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Acknowledgements</h1>
<p>This work was supported by the Economic and Social Research Council (ESRC) &amp; ADR UK as part of the ESRC-ADR UK No.10 Data Science (10DS) fellowship in collaboration with 10DS and ONS (Robin Lovelace, grant number ES/W004305/1).</p>
<p>It was also supported by funding from Transport Scotland via a contract with Sustrans to develop the Network Planning Tool for Scotland (NPT).</p>
<p>We also acknowledge the Network Rail Volunteer Leave Policy for the Promotion of Science, Technology, Engineering and Maths (STEM) subjects in universities, as discussions following an event at the Institute of Transport in Leeds led, in part, to this collaboration.</p>
<!--
# Author biographies

Will Deakin is the Trains Portfolio Architect in IT Delivery at Network Rail, the British national rail infrastructure manager.
Will is a passionate advocate of the use of data science, visualisation and open data to help support reproducible and fact based policy making.

Zhao Wang is a researcher at the Leeds Institute for Transport Studies (ITS).
Zhao specializes in machine learning, data science and geocomputation for transport planning and engineering.

Josiah Parry is a Senior Product Engineer at Environmental Systems Research Institute, Inc (Esri) and an open source software developer.

Robin Lovelace is Professor of Transport Data Science at the Leeds Institute for Transport Studies (ITS) and Head of Data Science at the UK government agency Active Travel England.
Robin specializes in data science and geocomputation, with a focus on modeling transport systems, active travel, and decarbonisation.
-->
</section>
<section id="references" class="level1" data-number="8">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">8 References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-barthélemy2011" class="csl-entry" role="listitem">
Barthélemy, Marc. 2011. <span>“Spatial Networks.”</span> <em>Physics Reports</em> 499 (1<span></span>3): 1101. <a href="http://www.sciencedirect.com/science/article/pii/S037015731000308X">http://www.sciencedirect.com/science/article/pii/S037015731000308X</a>.
</div>
<div id="ref-centerli2023" class="csl-entry" role="listitem">
<span>“Centerline - Crates.io: Rust Package Registry.”</span> 2023. <a href="https://crates.io/crates/centerline">https://crates.io/crates/centerline</a>.
</div>
<div id="ref-deakin2024" class="csl-entry" role="listitem">
Deakin, Will. 2024. <em>Parenx</em>. <a href="https://github.com/anisotropi4/parenx">https://github.com/anisotropi4/parenx</a>.
</div>
<div id="ref-duong2022statistical" class="csl-entry" role="listitem">
Duong, T. 2022. <span>“Statistical Visualisation for Tidy and Geospatial Data in r via Kernel Smoothing Methods in the Eks Package.”</span> <em>arXiv Preprint arXiv:2203.01686</em>.
</div>
<div id="ref-félix2025" class="csl-entry" role="listitem">
Félix, Rosa, Filipe Moura, and Robin Lovelace. 2025. <span>“Reproducible Methods for Modeling Combined Public Transport and Cycling Trips and Associated Benefits: Evidence from the biclaR Tool.”</span> <em>Computers, Environment and Urban Systems</em> 117 (April): 102230. <a href="https://doi.org/10.1016/j.compenvurbsys.2024.102230">https://doi.org/10.1016/j.compenvurbsys.2024.102230</a>.
</div>
<div id="ref-fleischmann2024" class="csl-entry" role="listitem">
Fleischmann, Martin, Anastassia Vybornova, and James Gaboardi. 2024. <em>Neatnet: Street Geometry Processing Toolkit</em>. <a href="https://github.com/uscuni/neatnet">https://github.com/uscuni/neatnet</a>.
</div>
<div id="ref-fleischmann2025adaptivecontinuitypreservingsimplificationstreet" class="csl-entry" role="listitem">
Fleischmann, Martin, Anastassia Vybornova, James D. Gaboardi, Anna Brázdová, and Daniela Dančejová. 2025. <span>“Adaptive Continuity-Preserving Simplification of Street Networks.”</span> <a href="https://arxiv.org/abs/2504.16198">https://arxiv.org/abs/2504.16198</a>.
</div>
<div id="ref-golly2017" class="csl-entry" role="listitem">
Golly, Antonius, and Jens M. Turowski. 2017. <span>“Deriving Principal Channel Metrics from Bank and Long-Profile Geometry with the r Package Cmgo.”</span> <em>Earth Surface Dynamics</em> 5 (3): 557–70. <a href="https://doi.org/10.5194/esurf-5-557-2017">https://doi.org/10.5194/esurf-5-557-2017</a>.
</div>
<div id="ref-grippa2018" class="csl-entry" role="listitem">
Grippa, Taïs, Stefanos Georganos, Soukaina Zarougui, Pauline Bognounou, Eric Diboulo, Yann Forget, Moritz Lennert, Sabine Vanhuysse, Nicholus Mboga, and Eléonore Wolff. 2018. <span>“Mapping Urban Land Use at Street Block Level Using OpenStreetMap, Remote Sensing Data, and Spatial Metrics.”</span> <em>ISPRS International Journal of Geo-Information</em> 7 (7): 246. <a href="https://doi.org/10.3390/ijgi7070246">https://doi.org/10.3390/ijgi7070246</a>.
</div>
<div id="ref-kujala2018" class="csl-entry" role="listitem">
Kujala, Rainer, Christoffer Weckström, Richard K. Darst, Miloš N Mladenović, and Jari Saramäki. 2018. <span>“A Collection of Public Transport Network Data Sets for 25 Cities.”</span> <em>Scientific Data</em> 5 (1). <a href="https://doi.org/10.1038/sdata.2018.89">https://doi.org/10.1038/sdata.2018.89</a>.
</div>
<div id="ref-leymarie1992" class="csl-entry" role="listitem">
Leymarie, F., and M. D. Levine. 1992. <span>“Simulating the Grassfire Transform Using an Active Contour Model.”</span> <em>IEEE Transactions on Pattern Analysis and Machine Intelligence</em> 14 (1): 56–75. <a href="https://doi.org/10.1109/34.107013">https://doi.org/10.1109/34.107013</a>.
</div>
<div id="ref-liu2020vector" class="csl-entry" role="listitem">
Liu, B., X. Liu, D. Li, Y. Shi, G. Fernandez, and Y. Wang. 2020. <span>“A Vector Line Simplification Algorithm Based on the Douglas–Peucker Algorithm, Monotonic Chains and Dichotomy.”</span> <em>ISPRS International Journal of Geo-Information</em> 9 (4): 251.
</div>
<div id="ref-lovelace2019" class="csl-entry" role="listitem">
Lovelace, Robin, Richard Ellison, and Malcolm Morgan. 2019. <em>Stplanr: Sustainable Transport Planning</em>.
</div>
<div id="ref-lovelace2017" class="csl-entry" role="listitem">
Lovelace, Robin, Anna Goodman, Rachel Aldred, Nikolai Berkoff, Ali Abbas, and James Woodcock. 2017. <span>“The Propensity to Cycle Tool: An Open Source Online System for Sustainable Transport Planning.”</span> <em>Journal of Transport and Land Use</em> 10 (1). <a href="https://doi.org/10.5198/jtlu.2016.862">https://doi.org/10.5198/jtlu.2016.862</a>.
</div>
<div id="ref-lovelace2024" class="csl-entry" role="listitem">
Lovelace, Robin, Joey Talbot, Eugeni Vidal-Tortosa, Hussein Mahfouz, Elaine Brick, Peter Wright, Gary O’Toole, Dan Brennan, and Suzanne Meade. 2024. <span>“Cycle Route Uptake and Scenario Estimation (CRUSE): An Approach for Developing Strategic Cycle Network Planning Tools.”</span> <em>European Transport Research Review</em> 16 (1). <a href="https://doi.org/10.1186/s12544-024-00668-8">https://doi.org/10.1186/s12544-024-00668-8</a>.
</div>
<div id="ref-de2014efficient" class="csl-entry" role="listitem">
Magalhaes, S. V. de, M. V. Andrade, W. R. Franklin, and W. Li. 2014. <span>“An Efficient Map Generalization Heuristic Based on the Visvalingam-Whyatt Algorithm.”</span>
</div>
<div id="ref-moral-carcedo2024" class="csl-entry" role="listitem">
Moral-Carcedo, Julián. 2024. <span>“Predicting Traffic Intensity in the Urban Area of Madrid: Integrating Route Network Topology into a Machine-Learning Model.”</span> <em>Engineering Applications of Artificial Intelligence</em> 137 (November): 109154. <a href="https://doi.org/10.1016/j.engappai.2024.109154">https://doi.org/10.1016/j.engappai.2024.109154</a>.
</div>
<div id="ref-morgan2020" class="csl-entry" role="listitem">
Morgan, Malcolm, and Robin Lovelace. 2020. <span>“Travel Flow Aggregation: Nationally Scalable Methods for Interactive and Online Visualisation of Transport Behaviour at the Road Network Level.”</span> <em>Environment &amp; Planning B: Planning &amp; Design</em>, July. <a href="https://doi.org/10.1177/2399808320942779">https://doi.org/10.1177/2399808320942779</a>.
</div>
<div id="ref-openstreetmap" class="csl-entry" role="listitem">
OpenStreetMap contributors. 2024. <span>“OpenStreetMap.”</span> <a href="https://www.openstreetmap.org/">https://www.openstreetmap.org/</a>.
</div>
<div id="ref-ordnancesurvey" class="csl-entry" role="listitem">
Ordnance Survey. 2025. <span>“OS OpenRoads.”</span> <a href="https://www.ordnancesurvey.co.uk/products/os-open-roads">https://www.ordnancesurvey.co.uk/products/os-open-roads</a>.
</div>
<div id="ref-parry_josiahparryanime_2025" class="csl-entry" role="listitem">
Parry, Josiah. 2025. <span>“<span>JosiahParry</span>/Anime.”</span> <a href="https://github.com/JosiahParry/anime">https://github.com/JosiahParry/anime</a>.
</div>
<div id="ref-pradhan2023modified" class="csl-entry" role="listitem">
Pradhan, A., and M. P. Pradhan. 2023. <span>“A Modified Bezier Curve Technique for Automatic Reconstruction of Broken Contour Lines Extracted from a Poor-Quality Topographic Map.”</span> <em>Multimedia Tools and Applications</em> 82 (12): 18299–325.
</div>
<div id="ref-smogavec2012" class="csl-entry" role="listitem">
Smogavec, G., and B. Žalik. 2012. <span>“A Fast Algorithm for Constructing Approximate Medial Axis of Polygons, Using Steiner Points.”</span> <em>Advances in Engineering Software</em> 52 (October): 1–9. <a href="https://doi.org/10.1016/j.advengsoft.2012.05.006">https://doi.org/10.1016/j.advengsoft.2012.05.006</a>.
</div>
<div id="ref-suri2021" class="csl-entry" role="listitem">
Suri, Sahaana, Ihab F. Ilyas, Christopher Ré, and Theodoros Rekatsinas. 2021. <span>“Ember: No-Code Context Enrichment via Similarity-Based Keyless Joins,”</span> November. <a href="https://doi.org/10.14778/3494124.3494149">https://doi.org/10.14778/3494124.3494149</a>.
</div>
<div id="ref-sutton1998" class="csl-entry" role="listitem">
Sutton, John. 1998. <span>“Data Attribution and Network Representation Issues in GIS and Transportation.”</span> <em>Transportation Planning and Technology</em> 21 (1-2): 25–41. <a href="https://doi.org/10.1080/03081069708717600">https://doi.org/10.1080/03081069708717600</a>.
</div>
<div id="ref-tyers2016" class="csl-entry" role="listitem">
Tyers, Matt. 2016. <span>“Riverdist: River Network Distance Computation and Applications.”</span> The R Foundation. <a href="https://doi.org/10.32614/cran.package.riverdist">https://doi.org/10.32614/cran.package.riverdist</a>.
</div>
<div id="ref-wachowicz2019" class="csl-entry" role="listitem">
Wachowicz, Anna, and Dariusz Mrozek. 2019. <span>“Fuzzy Join as a Preparation Step for the Analysis of Training Data.”</span> In, edited by Stanisław Kozielski, Dariusz Mrozek, Paweł Kasprowski, Bożena Małysiak-Mrozek, and Daniel Kostrzewa, 263–73. Communications in Computer and Information Science. Cham: Springer International Publishing. <a href="https://doi.org/10.1007/978-3-030-19093-4_20">https://doi.org/10.1007/978-3-030-19093-4_20</a>.
</div>
<div id="ref-yang2020" class="csl-entry" role="listitem">
Yang, Xiao, Tamlin M. Pavelsky, George H. Allen, and Gennadii Donchyts. 2020. <span>“RivWidthCloud: An Automated Google Earth Engine Algorithm for River Width Extraction from Remotely Sensed Imagery.”</span> <em>IEEE Geoscience and Remote Sensing Letters</em> 17 (2): 217–21. <a href="https://doi.org/10.1109/lgrs.2019.2920225">https://doi.org/10.1109/lgrs.2019.2920225</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/nptscot\.github\.io\/networkmerge\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>